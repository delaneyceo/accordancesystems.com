<?php
/**
 * @file
 * Code for the as_core module.
 */

/**
* Implements hook_form_node_form_alter().
*/
function as_core_form_node_form_alter(&$form, &$form_state) {
  $type = $form['type']['#value'];

  // Disable url path access globally and add execeptions for specific nodes
  if (!user_access('administer url aliases')) {
    $exceptions = array('page', 'webform');
    if (!in_array($type, $exceptions)) {
      $form['#after_build'][] = 'as_core_url_path_access_restriction';
    }
  }

  // Prevent the Footer Contact Block basic page node from deletion.
  if ($form['nid']['#value'] == '51') {
    unset($form['actions']['delete']);
  }
}

// Custom function to set path access.
function as_core_url_path_access_restriction($form, &$form_state) {
  $form['path']['#access'] = FALSE;
  $form_state['values']['path']['pathauto'] = 1;

  return ($form);

}

/**
* Implements hook_commerce_cybersource_sawm_transaction_data_alter().
* This will allow us to pass shipping information into Cybersource.
*/
function as_core_commerce_cybersource_sawm_transaction_data_alter(&$form, $order) {
  $order_wrapper = entity_metadata_wrapper('commerce_order', $order);

  // Prepare the shipping address for use in the request.
  $shipping_address = $order_wrapper->commerce_customer_shipping->commerce_customer_address->value();
  // dpm($shipping_address);
}
